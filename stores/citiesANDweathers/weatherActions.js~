import axios from "axios";
import {citiesData} from "../../constants";
export const GET_WEATHER_BEGIN = "GET_WEATHER_BEGIN";
export const GET_WEATHER_SUCCESS = "GET_BOOKS_SUCCESS";
export const GET_WEATHER_FAILURE = "GET_WEATHER_FAILURE";

APIkey ="4cbc0d6e-cbf3-11ec-a8d3-0242ac130002-4cbc0ddc-cbf3-11ec-a8d3-0242ac130002"

export const getWeatherBegin = () => ({
    type: GET_WEATHER_BEGIN
})

export const getWeatherSuccess = (todaysWeather) => ({
    type: GET_WEATHER_SUCCESS,
    payload: {todaysWeather}

})

export const getWeatherFailure = (error) => ({
    type: GET_WEATHER_FAILURE,
    payload: {error}
})

export function getTodaysWeather(){
    return dispatch => {
      dispatch(getWeatherBegin())
      const todaysWeather = new Object();
    
      citiesData?.map((city)=> {
          const lat = city.latitude;
          const lng = city.longitude;
          const params = 'time, airTemperature, precipitation,windspeed, Humidity, cloudCover,icecover ';
          let apiUrl = `https://api.stormglass.io/v2/weather/point?lat=${lat}&lng=${lng}&params=${params}`;
           
          return todaysWeather[city.name] =  axios({
               url : apiUrl,
               method: 'GET',
               header : {
                   Authorization :  `${APIkey}`,
                   Accept: "application/json"
               }
           }).then((response) => {
              console.log(`${city.name}`,response)
              if (response.status == 200) {
                  //Message data
                  let cityWeather = response.data.map((item) => {
                      return {
                          time : item.time,
                          airTemperature: item.airTemperature,
                          precipitation: item.precipitation,
                          windSpeed : item.windSpeed,
                      }
                  })
                 dispatch(getWeatherSuccesss(cu))
              } else {
                 dispatch(getWeatherFailure(response.data))
           }).catch((error) => {
               dispatch(getWeatherFailure(error))
           })
      })
      dispatch(getWeatherSuccess(todaysWeather))
      console.log("todaysWeather: ", todaysWeather)      
    }
  console.log("todaysWeather: ", todaysWeather)
}
